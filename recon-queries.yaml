public_ips:
  description: "Fetch all public IPs"
  query: |
    select
      eni.association_public_ip AS public_ip
    from
      aws_ec2_network_interface AS eni
    where
      eni.association_public_ip is not Null;

enumerate_hostnames:
  description: "Enumerate all hostnames"
  query: |
    select
      r.name as hostname,
      type,
      jsonb_array_elements_text(records) as resource_record
    from
      aws_route53_zone as z,
      aws_route53_record as r
    where
      r.zone_id = z.id
      and (type LIKE 'A' OR type LIKE 'CNAME')
      and z.private_zone=false
      and jsonb_pretty(records) not like '%dkim%'
      and jsonb_pretty(records) not like '%acm-validations.aws.%';

list_s3_urls:
  description: "List all URLs from public S3 buckets"
  query: |
    select
      'https://' || name || '.s3.' || region || '.amazonaws.com/' as url
    from
      aws_s3_bucket
    where
      bucket_policy_is_public is True;

list_console_users:
  description: "List IAM users with console access."
  query: |
    select
      name,
      user_id,
      password_last_used
    from
      aws_iam_user
    where
      password_last_used is not null;
