lambda_functions_with_unencrypted_environment_variables:
  description: "List Lambda functions using environment variables without a customer-managed KMS key"
  query: |
    select
      name as function_name,
      runtime,
      kms_key_arn,
      environment_variables
    from
      aws_lambda_function
    where
      coalesce(jsonb_object_length(environment_variables), 0) > 0
      and kms_key_arn is null;
