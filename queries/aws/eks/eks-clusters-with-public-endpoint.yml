eks_clusters_with_public_endpoint:
  description: "List EKS clusters with public endpoint access enabled"
  query: |
    select
        name as cluster_name,
        arn as cluster_arn,
        resources_vpc_config->'VpcId' as vpc_id,
        resources_vpc_config->'ClusterSecurityGroupId' as cluster_security_group_id,
        resources_vpc_config->'EndpointPrivateAccess' as endpoint_private_access,
        resources_vpc_config->'EndpointPublicAccess' as endpoint_public_access,
        resources_vpc_config->'PublicAccessCidrs' as public_access_cidrs,
        resources_vpc_config->'SubnetIds' as subnet_ids,
        endpoint as cluster_endpoint
    from
        aws_eks_cluster
    where
        resources_vpc_config->'EndpointPublicAccess' = 'true'
